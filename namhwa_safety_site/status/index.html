<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대광새마을금고 골프연습장 법적 안전관리 통합 공정표</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .page-break { page-break-before: always; }
            .print-fit { max-width: 100% !important; margin: 0 !important; padding: 0 !important; }
            .overflow-x-auto { overflow-x: visible !important; }
        }
        .editable:focus {
            outline: 2px solid #2563eb;
            background-color: #eff6ff;
            border-radius: 4px;
            padding: 2px;
        }
        /* Gantt Chart Grid Layout */
        .gantt-container {
            display: grid;
            /* Header (180px) + 10 Months */
            grid-template-columns: 180px repeat(10, 1fr); 
            border: 1px solid #e5e7eb;
            background-color: #f9fafb;
            font-size: 0.7rem;
        }
        .gantt-header-cell {
            background-color: #f3f4f6;
            border-bottom: 1px solid #d1d5db;
            border-right: 1px solid #e5e7eb;
            padding: 6px;
            font-weight: bold;
            text-align: center;
            color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gantt-row-label {
            background-color: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            border-right: 1px solid #e5e7eb;
            padding: 6px 10px;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            font-size: 0.75rem;
        }
        .gantt-cell {
            background-color: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            border-right: 1px solid #e5e7eb;
            position: relative;
            height: 42px; 
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            padding: 1px;
            gap: 2px;
        }
        
        /* Construction Bar */
        .const-bar {
            position: absolute;
            top: 10px;
            bottom: 10px;
            left: 2px;
            right: 2px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.7rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            z-index: 10;
        }

        /* Safety Markers (Badges) */
        .safety-badge {
            font-size: 0.6rem;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
            border: 1px solid rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 20;
            white-space: nowrap;
            box-shadow: 0 1px 1px rgba(0,0,0,0.05);
            line-height: 1.2;
        }
        
        /* Color Schemes for Safety Badges */
        .badge-risk { background-color: #dbeafe; color: #1e40af; border-color: #93c5fd; } /* Risk */
        .badge-edu { background-color: #dcfce7; color: #166534; border-color: #86efac; } /* Education */
        .badge-meet { background-color: #f3e8ff; color: #6b21a8; border-color: #d8b4fe; } /* Meeting */
        .badge-check { background-color: #ffedd5; color: #9a3412; border-color: #fdba74; } /* Inspection */
        .badge-perf { background-color: #fce7f3; color: #be185d; border-color: #fbcfe8; } /* Performance (KPI) */
        .badge-tbm { background-color: #fae8ff; color: #86198f; border-color: #f0abfc; } /* TBM */

    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-gray-800">

    <!-- Top Control Bar -->
    <div class="bg-white shadow-sm sticky top-0 z-50 no-print border-b">
        <div class="max-w-7xl mx-auto px-4 py-2 flex justify-between items-center">
            <h1 class="text-lg font-bold text-gray-800 flex items-center">
                <i class="fas fa-chart-line mr-2 text-blue-600"></i>
                <span>법적 안전관리 및 성과측정 통합 로드맵</span>
            </h1>
            <div class="space-x-2">
                <button onclick="location.reload()" class="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm">
                    <i class="fas fa-sync-alt mr-1"></i> 초기화
                </button>
                <button onclick="window.print()" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm font-bold">
                    <i class="fas fa-print mr-1"></i> 출력 / PDF 저장
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-6 print-fit" id="report-content">
        
        <!-- Project Header -->
        <div class="bg-white rounded-lg border border-gray-200 p-6 mb-6 shadow-sm">
            <div class="flex justify-between items-start border-b pb-4 mb-4">
                <div>
                    <h2 class="text-2xl font-extrabold text-gray-900 editable" contenteditable="true">
                        대광새마을금고 골프연습장 신축공사
                    </h2>
                    <p class="text-gray-500 text-sm mt-1 font-semibold">자기규율 예방체계(성과지표 포함) 통합 로드맵</p>
                </div>
                <div class="text-right text-xs text-gray-500">
                    <p>작성일: <span id="current-date"></span></p>
                    <p class="editable" contenteditable="true">안전보건총괄책임자: 홍길동 / 안전관리자: 김안전</p>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-4 text-sm">
                <div class="bg-blue-50 p-3 rounded border border-blue-100">
                    <span class="font-bold text-blue-800 block"><i class="far fa-calendar-alt mr-1"></i> 공사 기간</span>
                    <span class="editable" contenteditable="true">실착공일로부터 10개월</span>
                </div>
                <div class="bg-gray-50 p-3 rounded border border-gray-200">
                    <span class="font-bold text-gray-700 block"><i class="fas fa-building mr-1"></i> 공사 규모</span>
                    <span class="editable" contenteditable="true">지하1층 ~ 지상4층 / 49타석 (철골+RC조)</span>
                </div>
                <div class="bg-pink-50 p-3 rounded border border-pink-100">
                    <span class="font-bold text-pink-800 block"><i class="fas fa-trophy mr-1"></i> 안전 목표</span>
                    <span class="editable" contenteditable="true">중대재해 ZERO / 무재해 300일 달성</span>
                </div>
            </div>
        </div>

        <!-- GANTT CHART SECTION -->
        <div class="bg-white p-1 mb-6 rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            
            <!-- Legend -->
            <div class="p-3 bg-gray-50 border-b flex justify-between items-center flex-wrap gap-2">
                <h3 class="font-bold text-gray-800 text-sm flex items-center">
                    <i class="fas fa-align-left text-blue-600 mr-2"></i> 월별 안전관리 및 성과 모니터링
                </h3>
                <div class="flex gap-2 text-[10px]">
                    <span class="badge-risk px-2 py-1 rounded">위험성평가</span>
                    <span class="badge-edu px-2 py-1 rounded">안전교육</span>
                    <span class="badge-meet px-2 py-1 rounded">협의체</span>
                    <span class="badge-check px-2 py-1 rounded">점검</span>
                    <span class="badge-perf px-2 py-1 rounded">성과측정</span>
                </div>
            </div>

            <!-- Gantt Grid -->
            <div class="overflow-x-auto">
                <div class="gantt-container" id="gantt-chart">
                    <!-- Headers (Generated by JS) -->
                </div>
            </div>
        </div>

        <!-- 3. MONTHLY SAFETY ROADMAP TABLE -->
        <div class="bg-white shadow-sm rounded-lg overflow-hidden border border-gray-200">
            <div class="bg-gray-800 text-white px-4 py-2 font-bold text-sm flex items-center justify-between">
                <span><i class="fas fa-clipboard-list mr-2"></i>월별 안전보건 중점 활동 및 성과 목표 (KPI)</span>
            </div>
            <table class="min-w-full divide-y divide-gray-200 text-sm">
                <thead class="bg-gray-100 text-gray-700">
                    <tr>
                        <th class="px-3 py-2 border-r w-14 text-center">월</th>
                        <th class="px-3 py-2 border-r w-1/6">주요 공정</th>
                        <th class="px-3 py-2 border-r w-1/6">핵심 위험 (Risk)</th>
                        <th class="px-3 py-2 border-r">안전보건 활동 (P-D-C-A)</th>
                        <th class="px-3 py-2 border-r w-24 text-center text-blue-700 bg-blue-50">성과 지표 (KPI)</th>
                        <th class="px-3 py-2 w-20 text-center">법적서류</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="roadmap-body">
                    <!-- Rows Generated by JS -->
                </tbody>
            </table>
        </div>

        <div class="mt-8 text-center">
            <p class="text-base font-bold text-gray-800 editable" contenteditable="true">안전보건팀</p>
            <p class="text-xs text-gray-400 mt-1">※ 본 일정은 산업안전보건법, 중대재해처벌법 및 현장 상황에 따라 변경될 수 있습니다.</p>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. DATA DEFINITION
        // ==========================================
        
        // Construction Process Data
        const constructionTasks = [
            { name: "가설/토공사", start: 1, duration: 1, color: "bg-gray-500", label: "가설(EGI)/터파기" },
            { name: "기초/지하골조", start: 2, duration: 1, color: "bg-blue-600", label: "기초/지하" },
            { name: "지상골조(RC)", start: 3, duration: 3, color: "bg-blue-500", label: "1F~4F 골조" },
            { name: "철골/철탑공사", start: 3, duration: 2, color: "bg-red-600", label: "철탑/타석 빔" }, // High Risk
            { name: "마감/창호/방수", start: 6, duration: 2, color: "bg-yellow-500", label: "내외장/방수" },
            { name: "비계해체/정리", start: 7, duration: 1, color: "bg-yellow-600", label: "비계해체" },
            { name: "부대토목/조경", start: 9, duration: 1, color: "bg-green-600", label: "포장/조경" },
            { name: "준공/인계", start: 10, duration: 1, color: "bg-gray-600", label: "준공" }
        ];

        // Legal Safety Activities & Performance
        const safetyRowsDefinition = [
            { id: "risk", title: "위험성평가 (Risk Assessment)", color: "border-blue-500" },
            { id: "edu", title: "안전보건교육 (Education)", color: "border-green-500" },
            { id: "meet", title: "협의체 및 회의 (Meeting)", color: "border-purple-500" },
            { id: "check", title: "법적 점검 (Inspection)", color: "border-orange-500" },
            { id: "perf", title: "성과 측정 및 분석 (Performance)", color: "border-pink-500" } // Added
        ];

        function getSafetyBadges(rowId, month) {
            const badges = [];

            // 1. 위험성평가
            if (rowId === "risk") {
                if (month === 1) badges.push({ text: "최초평가", style: "badge-risk" });
                else badges.push({ text: "상시/월간", style: "badge-risk" });
                badges.push({ text: "TBM(매일)", style: "badge-tbm" });
            }

            // 2. 안전보건교육
            if (rowId === "edu") {
                if (month === 1) badges.push({ text: "채용시교육", style: "badge-edu" });
                badges.push({ text: "정기교육", style: "badge-edu" });
                if (month === 1) badges.push({ text: "특별(장비)", style: "badge-edu bg-red-100 text-red-800 border-red-200" });
                if (month === 2) badges.push({ text: "특별(밀폐)", style: "badge-edu bg-red-100 text-red-800 border-red-200" });
                if (month === 3) badges.push({ text: "특별(철탑)", style: "badge-edu bg-red-100 text-red-800 border-red-200" });
                if (month === 5) badges.push({ text: "물질안전", style: "badge-edu" });
                if (month === 7) badges.push({ text: "특별(해체)", style: "badge-edu bg-red-100 text-red-800 border-red-200" });
            }

            // 3. 협의체 및 회의
            if (rowId === "meet") {
                badges.push({ text: "안전보건협의체", style: "badge-meet" });
            }

            // 4. 점검
            if (rowId === "check") {
                badges.push({ text: "합동 안전점검", style: "badge-check font-bold" });
                if (month === 6) badges.push({ text: "장마철점검", style: "badge-check" });
                if (month === 1) badges.push({ text: "해빙기점검", style: "badge-check" });
            }

            // 5. 성과 측정 (NEW)
            if (rowId === "perf") {
                // Monthly Routine
                badges.push({ text: "이행점검", style: "badge-perf" });
                
                // Quarterly Analysis
                if ([3, 6, 9].includes(month)) {
                    badges.push({ text: "결과분석", style: "badge-perf font-bold" });
                }
                // Half-yearly Review
                if (month === 6 || month === 10) {
                    badges.push({ text: "경영검토", style: "badge-perf font-bold bg-pink-200" });
                }
            }

            return badges;
        }

        // Roadmap Details with KPI
        const roadmapDetails = [
            { m: "1월", p: "가설(EGI), 터파기", r: "가설물 전도, 협착", a: "• [평가] 최초 위험성평가 실시 및 전파<br>• [교육] 신규자 특별안전교육(장비)<br>• [점검] 월간 합동 안전점검 (1회차)", kpi: "교육 이수율<br>100%", d: "유해위험<br>방지계획서", c: "" },
            { m: "2월", p: "기초/지하 골조", r: "거푸집 붕괴, 질식", a: "• [평가] 골조공사 상시 위험성평가<br>• [교육] 밀폐공간 작업 특별교육<br>• [점검] 합동점검: 개구부 덮개 확인", kpi: "밀폐공간<br>허가 100%", d: "콘크리트<br>타설승인", c: "" },
            { m: "3월", p: "<b>철탑(60m) 인양</b>", r: "<b>크레인 전도, 낙하</b>", a: "• <b>[평가] 철탑 인양 수시 위험성평가</b><br>• [분석] 1분기 안전관리비 사용내역 분석<br>• [점검] 합동점검: 줄걸이 및 지반상태", kpi: "위험요인<br>개선율 90%↑", d: "중량물<br>작업계획서", c: "bg-red-50" },
            { m: "4월", p: "지상 골조, 타석철골", r: "용접 화재, 추락", a: "• [활동] 화기작업 허가제 및 감시자 배치<br>• [TBM] 철골 위 이동 시 생명줄 체결<br>• [협의] 협력업체 소장단 안전보건협의체", kpi: "화기작업<br>승인 100%", d: "화기작업<br>허가서", c: "" },
            { m: "5월", p: "옥상 골조, 데크", r: "단부 추락, 붕괴", a: "• [교육] 데크플레이트 특별안전교육<br>• [점검] 합동점검: 데크 용접부 확인<br>• [TBM] 슬래브 단부 안전난간 상태 확인", kpi: "TBM<br>참여율 100%", d: "비계조립<br>승인서", c: "" },
            { m: "6월", p: "조적/방수/창호", r: "중독, 말비계 전도", a: "• [검토] 상반기 안전보건 이행결과 경영검토<br>• [활동] 밀폐공간 질식재해 예방 프로그램<br>• [점검] 우기 대비 특별 합동점검", kpi: "부적합 사항<br>조치율 100%", d: "MSDS<br>교육일지", c: "" },
            { m: "7월", p: "외벽/비계 해체", r: "<b>해체 중 추락/낙하</b>", a: "• <b>[평가] 비계 해체작업 수시 위험성평가</b><br>• [교육] 해체 작업자 특별안전교육<br>• [점검] 합동점검: 하부 통제구역 설정", kpi: "아차사고<br>발굴 5건↑", d: "해체<br>계획서", c: "" },
            { m: "8월", p: "내부 수장/천장", r: "사다리 추락, 화재", a: "• [교육] 화재 예방 및 비상 대피 훈련<br>• [TBM] 이동식 사다리 전도방지 조치<br>• [점검] 합동점검: 가설전기 누전 확인", kpi: "비상훈련<br>실시 완료", d: "가설전기<br>점검표", c: "" },
            { m: "9월", p: "토목, 설비(오토티업)", r: "장비 충돌, 협착", a: "• [분석] 3분기 합동안전점검 결과 분석<br>• [활동] 오토티업 설비 LOTO 준수<br>• [점검] 합동점검: 장비 유도원 배치", kpi: "장비점검<br>실시율 100%", d: "기계기구<br>방호조치", c: "" },
            { m: "10월", p: "준공 청소, 인계", r: "전도, 폐기물 사고", a: "• [검토] 공사 전체 무재해 달성 최종 확인<br>• [평가] 준공 마무리 작업 위험성평가<br>• [정리] 안전시설물 철거 시 관리자 입회", kpi: "<b>무재해<br>달성</b>", d: "안전보건<br>대장", c: "" }
        ];

        // ==========================================
        // 2. RENDERING FUNCTIONS
        // ==========================================

        function renderGantt() {
            const container = document.getElementById('gantt-chart');
            container.innerHTML = ''; // Clear

            // 1. Headers
            const headers = ['구분 / 월', '1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월'];
            headers.forEach(h => {
                const div = document.createElement('div');
                div.className = "gantt-header-cell";
                div.innerText = h;
                container.appendChild(div);
            });

            // 2. Construction Rows (Task Bars)
            constructionTasks.forEach(task => {
                // Label
                const labelDiv = document.createElement('div');
                labelDiv.className = "gantt-row-label pl-4 border-l-4 border-blue-500";
                labelDiv.innerHTML = task.name;
                container.appendChild(labelDiv);

                // Month Cells
                for (let i = 1; i <= 10; i++) {
                    const cell = document.createElement('div');
                    cell.className = "gantt-cell";
                    
                    // Draw Bar if match
                    if (i >= task.start && i < task.start + task.duration) {
                        if (i === task.start) {
                            const bar = document.createElement('div');
                            bar.className = `const-bar ${task.color}`;
                            bar.style.width = `calc(${task.duration * 100}% + ${task.duration - 1}px - 4px)`;
                            bar.innerText = task.label;
                            cell.appendChild(bar);
                            cell.style.overflow = "visible";
                            cell.style.zIndex = "10";
                        }
                    }
                    container.appendChild(cell);
                }
            });

            // 3. Separator
            const sepLabel = document.createElement('div');
            sepLabel.className = "gantt-header-cell bg-gray-100 col-span-full py-1 text-xs border-t-2 border-gray-300 font-bold text-gray-500";
            sepLabel.innerText = "▼ 법적 안전관리 및 성과 측정 일정 (Legal & Performance Schedule)";
            container.appendChild(sepLabel);

            // 4. Legal Safety Rows (Generated Programmatically)
            safetyRowsDefinition.forEach(rowDef => {
                // Label
                const labelDiv = document.createElement('div');
                labelDiv.className = `gantt-row-label pl-4 border-l-4 ${rowDef.color} bg-gray-50 text-xs`;
                labelDiv.innerText = rowDef.title;
                container.appendChild(labelDiv);

                // Cells
                for (let i = 1; i <= 10; i++) {
                    const cell = document.createElement('div');
                    cell.className = "gantt-cell bg-gray-50";
                    
                    // Get Badges for this month and row
                    const badges = getSafetyBadges(rowDef.id, i);
                    
                    badges.forEach(b => {
                        const span = document.createElement('span');
                        span.className = `safety-badge ${b.style}`;
                        span.innerText = b.text;
                        cell.appendChild(span);
                    });

                    container.appendChild(cell);
                }
            });
        }

        function renderTable() {
            const tbody = document.getElementById('roadmap-body');
            tbody.innerHTML = '';
            roadmapDetails.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = row.c ? row.c : "hover:bg-gray-50";
                tr.innerHTML = `
                    <td class="px-3 py-3 border-r text-center font-bold text-gray-700 editable" contenteditable="true">${row.m}</td>
                    <td class="px-3 py-3 border-r text-gray-600 editable" contenteditable="true">${row.p}</td>
                    <td class="px-3 py-3 border-r text-red-600 editable" contenteditable="true">${row.r}</td>
                    <td class="px-3 py-3 border-r text-gray-800 editable" contenteditable="true">${row.a}</td>
                    <td class="px-3 py-3 border-r text-center text-blue-700 font-bold text-xs editable bg-blue-50" contenteditable="true">${row.kpi}</td>
                    <td class="px-3 py-3 text-center text-gray-500 text-xs editable" contenteditable="true">${row.d}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Init
        const today = new Date();
        document.getElementById('current-date').innerText = `${today.getFullYear()}.${today.getMonth()+1}.${today.getDate()}`;
        renderGantt();
        renderTable();

    </script>
</body>
</html>