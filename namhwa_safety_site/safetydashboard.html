<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety ON - 스마트 안전보건 플랫폼</title>
    
    <!-- React 및 라이브러리 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        @font-face {
            font-family: 'SeoulHangang';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/SeoulHangangM.woff') format('woff');
            font-weight: normal; font-style: normal;
        }
        body { font-family: Pretendard, sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media print {
            @page { size: A4; margin: 10mm; }
            body { background-color: white !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
        }
        .print-only { display: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDbVG3iL3FBJe6alPLZnhFW_QAGpzeqFoY",
            authDomain: "namhwa-safety-dashboard.firebaseapp.com",
            projectId: "namhwa-safety-dashboard",
            storageBucket: "namhwa-safety-dashboard.firebasestorage.app",
            messagingSenderId: "152864778612",
            appId: "1:152864778612:web:ecc482adce93a1534a2421"
        };

        let db = null;
        let storage = null;
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            storage = firebase.storage();
        } catch (error) { console.error("Firebase Init Error:", error); }

        // --- 아이콘 컴포넌트 생략 (기존과 동일) ---
        const Icon = ({ children, color = "currentColor", size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const CalendarIcon = (props) => <Icon {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></Icon>;
        const Bell = (props) => <Icon {...props}><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></Icon>;
        const Users = (props) => <Icon {...props}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></Icon>;
        const MoreHorizontal = (props) => <Icon {...props}><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></Icon>;
        const AlertTriangle = (props) => <Icon {...props}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></Icon>;
        const AlertOctagon = (props) => <Icon {...props}><polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Icon>;
        const Save = (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
        const Edit2 = (props) => <Icon {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></Icon>;
        const MessageSquare = (props) => <Icon {...props}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></Icon>;
        const Plus = (props) => <Icon {...props}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const Activity = (props) => <Icon {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></Icon>;
        const Truck = (props) => <Icon {...props}><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></Icon>;
        const FlaskConical = (props) => <Icon {...props}><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/><line x1="8.5" y1="2" x2="15.5" y2="2"/><path d="M8.5 14h7"/></Icon>;
        const X = (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></Icon>;
        const Upload = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></Icon>;
        const Trash = (props) => <Icon {...props}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></Icon>;
        const Tool = (props) => <Icon {...props}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></Icon>;
        const Settings = (props) => <Icon {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>;
        const LinkIcon = (props) => <Icon {...props}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></Icon>;
        const Printer = (props) => <Icon {...props}><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></Icon>;
        const ClipboardCheck = (props) => <Icon {...props}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></Icon>;
        const ArrowRight = (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></Icon>;

        // 인쇄용 컴포넌트
        const PrintReport = ({ data, siteName, currentDate, accidentFreeDays, targetDays }) => {
            return (
                <div className="print-only p-4">
                    <div className="border-b-2 border-black pb-4 mb-6">
                        <h1 className="text-3xl font-bold text-center mb-2">안전보건 일일 리포트</h1>
                        <div className="flex justify-between text-sm">
                            <span>현장명: {siteName}</span>
                            <span>작성일: {currentDate}</span>
                            <span>무재해: {accidentFreeDays}일 (목표: {targetDays}일)</span>
                        </div>
                    </div>
                    {/* (인쇄 내용 생략 - 기존과 동일) */}
                    <div className="text-center text-xs text-gray-400 mt-8 border-t pt-4">남화토건(주) 스마트 안전보건 플랫폼 - Safety ON Output System</div>
                </div>
            );
        };

        const SafetyDashboard = () => {
            const [currentDate, setCurrentDate] = useState('');
            const queryParams = new URLSearchParams(window.location.search);
            const siteId = queryParams.get('siteId') || 'siteB'; 
            
            // [수정됨] 공정표 연결 링크를 statusA, statusB 폴더 경로로 변경
            const siteConfig = {
                'siteA': { name: '대광새마을금고 신축공사', link: './statusA/index.html', theme: 'blue', gradient: 'from-blue-700 to-blue-500', text: 'text-blue-900', bg: 'bg-blue-600' },
                'siteB': { name: '수원 노유자시설 신축공사', link: './statusB/suwon.html', theme: 'purple', gradient: 'from-purple-700 to-purple-500', text: 'text-purple-900', bg: 'bg-purple-600' }
            };
            const currentSiteInfo = siteConfig[siteId] || siteConfig['siteB'];

            const [startDate, setStartDate] = useState('2024-01-01');
            const [targetDays, setTargetDays] = useState(500);
            const [accidentFreeDays, setAccidentFreeDays] = useState(0);
            const [riskWorks, setRiskWorks] = useState([]);
            const [noticeData, setNoticeData] = useState([]);
            const [issueList, setIssueList] = useState([]); 
            const [inspectionLog, setInspectionLog] = useState([]);
            const [workerList, setWorkerList] = useState([]);
            
            // UI States
            const [showWorkerModal, setShowWorkerModal] = useState(false);
            const [showIssueModal, setShowIssueModal] = useState(false);
            const [selectedIssueType, setSelectedIssueType] = useState(null); 
            const [editingWorkId, setEditingWorkId] = useState(null);
            const [showInspectionModal, setShowInspectionModal] = useState(false);
            const [inspectionType, setInspectionType] = useState('');
            const [showSettingsModal, setShowSettingsModal] = useState(false); 
            const [selectedNotice, setSelectedNotice] = useState(null); 
            const [inspectionImages, setInspectionImages] = useState([]);

            useEffect(() => {
                const today = new Date();
                setCurrentDate(`${today.getFullYear()}년 ${today.getMonth() + 1}월 ${today.getDate()}일`);
                const todayMidnight = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const startParts = startDate.split('-'); 
                const startMidnight = new Date(parseInt(startParts[0]), parseInt(startParts[1]) - 1, parseInt(startParts[2]));
                const diffTime = todayMidnight - startMidnight;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 
                setAccidentFreeDays(diffDays >= 0 ? diffDays + 1 : 0);
            }, [startDate]);

            useEffect(() => {
                if (db) {
                    const siteRef = db.collection('sites').doc(siteId);
                    const unsubSite = siteRef.onSnapshot(doc => {
                        if (doc.exists) {
                            const data = doc.data();
                            if(data.startDate) setStartDate(data.startDate);
                            if(data.targetDays) setTargetDays(data.targetDays);
                        } else {
                            siteRef.set({ startDate: '2024-01-01', targetDays: 500 }, { merge: true });
                        }
                    });

                    // 리스너 등록
                    const unsubRisk = siteRef.collection('riskWorks').onSnapshot(snap => setRiskWorks(snap.docs.map(d => ({id: d.id, ...d.data()}))));
                    const unsubNotice = siteRef.collection('notices').orderBy('date', 'desc').onSnapshot(snap => setNoticeData(snap.docs.map(d => ({id: d.id, ...d.data()}))));
                    const unsubIssue = siteRef.collection('issues').onSnapshot(snap => setIssueList(snap.docs.map(d => ({id: d.id, ...d.data()}))));
                    const unsubInsp = siteRef.collection('inspections').orderBy('date', 'desc').onSnapshot(snap => setInspectionLog(snap.docs.map(d => ({id: d.id, ...d.data()}))));
                    const unsubWorker = siteRef.collection('workers').onSnapshot(snap => setWorkerList(snap.docs.map(d => ({id: d.id, ...d.data()}))));

                    return () => { unsubSite(); unsubRisk(); unsubNotice(); unsubIssue(); unsubInsp(); unsubWorker(); };
                }
            }, [siteId]);

            const issueCounts = {
                new: issueList.filter(i => i.status === 'new').length,
                processing: issueList.filter(i => i.status === 'processing').length,
                done: issueList.filter(i => i.status === 'done').length
            };
            const filteredIssues = issueList.filter(i => i.status === selectedIssueType);

            // --- Handlers ---
            const handleWorkEdit = (id) => setEditingWorkId(id);
            const handleWorkSave = (id) => { 
                setEditingWorkId(null); 
                const workToSave = riskWorks.find(w => w.id === id);
                if(workToSave && db) db.collection('sites').doc(siteId).collection('riskWorks').doc(id).update(workToSave);
            };
            const handleWorkChange = (id, field, value) => { setRiskWorks(riskWorks.map(work => work.id === id ? { ...work, [field]: value } : work)); };
            const handleAddWork = () => { if(db) db.collection('sites').doc(siteId).collection('riskWorks').add({ team: '', task: '', risk: '중', manager: '', status: '예정', workerCount: 0, eduCompleted: 0, assessment: '' }); };
            const handleDeleteWork = (id) => { if(confirm("삭제하시겠습니까?") && db) db.collection('sites').doc(siteId).collection('riskWorks').doc(id).delete(); };

            const handleWorkerChange = (id, field, value) => { setWorkerList(workerList.map(w => w.id === id ? { ...w, [field]: value } : w)); };
            const handleAddWorker = () => setWorkerList([...workerList, { id: Date.now().toString(), trade: '', count: 0 }]);
            const handleDeleteWorker = (id) => setWorkerList(workerList.filter(w => w.id !== id));
            const saveWorkersToDB = async () => {
                if(!db) return;
                const batch = db.batch();
                const workerRef = db.collection('sites').doc(siteId).collection('workers');
                const snapshot = await workerRef.get();
                const dbIds = snapshot.docs.map(doc => doc.id);
                const currentIds = workerList.map(w => String(w.id));
                dbIds.forEach(dbId => { if (!currentIds.includes(dbId)) batch.delete(workerRef.doc(dbId)); });
                workerList.forEach(w => { batch.set(workerRef.doc(String(w.id)), { trade: w.trade, count: parseInt(w.count) || 0 }, { merge: true }); });
                await batch.commit();
                setShowWorkerModal(false);
            };

            const handleIssueChange = (id, field, value) => { setIssueList(issueList.map(issue => issue.id === id ? { ...issue, [field]: value } : issue)); };
            const handleAddIssue = () => {
                const newIssue = { loc: '', desc: '', finder: '관리자', status: 'new', beforeImg: null, afterImg: null, date: new Date().toISOString().slice(0, 10) };
                if(db) db.collection('sites').doc(siteId).collection('issues').add(newIssue);
            };

            const handleIssueImageUpload = (id, type, e) => {
                const file = e.target.files[0];
                if (!file || !storage) return;
                const targetIssue = issueList.find(i => i.id === id);
                const safeLoc = targetIssue && targetIssue.loc ? targetIssue.loc.replace(/\s+/g, '') : '장소미상';
                const today = new Date().toISOString().slice(0, 10); 
                const typeName = type === 'beforeImg' ? '조치전' : '조치후';
                const fileName = `${safeLoc}_${typeName}_${Date.now()}.jpg`;
                const fullPath = `sites/${currentSiteInfo.name}/안전부적합/${today}/${fileName}`;
                const storageRef = storage.ref(fullPath);
                storageRef.put(file).then(snapshot => snapshot.ref.getDownloadURL())
                    .then(downloadURL => {
                        setIssueList(prev => prev.map(issue => issue.id === id ? { ...issue, [type]: downloadURL } : issue));
                        if(db) db.collection('sites').doc(siteId).collection('issues').doc(id).update({ [type]: downloadURL });
                    })
                    .catch(error => { console.error("업로드 실패:", error); alert("사진 업로드 실패!"); });
            };

            const saveIssueChanges = () => {
                 if(!db) return;
                 const batch = db.batch();
                 filteredIssues.forEach(issue => {
                     const ref = db.collection('sites').doc(siteId).collection('issues').doc(issue.id);
                     batch.update(ref, { loc: issue.loc, finder: issue.finder, desc: issue.desc, beforeImg: issue.beforeImg || null, afterImg: issue.afterImg || null });
                 });
                 batch.commit().then(() => setShowIssueModal(false));
            };
            const changeIssueStatus = (id, newStatus) => { 
                const targetIssue = issueList.find(i => i.id === id);
                if (!targetIssue) return;
                setIssueList(prev => prev.map(issue => issue.id === id ? { ...issue, status: newStatus } : issue));
                if(db) db.collection('sites').doc(siteId).collection('issues').doc(id).set({ ...targetIssue, status: newStatus }, { merge: true });
            };

            const handleAddNotice = () => { 
                const title = prompt("제목 입력"); 
                if(title && db) db.collection('sites').doc(siteId).collection('notices').add({ type: '공지', title, content: '', author: '관리자', date: new Date().toISOString().slice(5,10) });
            };
            const handleDeleteNotice = (id) => {
                if(confirm("삭제하시겠습니까?") && db) db.collection('sites').doc(siteId).collection('notices').doc(id).delete();
            };

            const openInspectionModal = (type) => { setInspectionType(type); setInspectionImages([]); setShowInspectionModal(true); };

            const handleInspectionImageUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0 || !storage) return;
                try {
                    const today = new Date().toISOString().slice(0, 10);
                    const uploadPromises = files.map(file => {
                        const fullPath = `sites/${currentSiteInfo.name}/반입점검/${inspectionType}/${today}/${Date.now()}_${file.name}`;
                        return storage.ref(fullPath).put(file).then(snapshot => snapshot.ref.getDownloadURL());
                    });
                    const newImageUrls = await Promise.all(uploadPromises);
                    setInspectionImages(prev => [...prev, ...newImageUrls]);
                } catch (error) { console.error("점검 사진 업로드 실패:", error); alert("사진 업로드 실패!"); }
            };

            const handleRemoveInspectionImage = (index) => { setInspectionImages(prev => prev.filter((_, i) => i !== index)); };
            const handleSaveInspection = (e) => { 
                e.preventDefault(); 
                if(db) db.collection('sites').doc(siteId).collection('inspections').add({ type: inspectionType, item: e.target.item.value, date: new Date().toISOString().slice(5,10), status: e.target.result.value, images: inspectionImages || [] });
                setShowInspectionModal(false); 
            };

            const handleSaveSettings = (e) => { 
                e.preventDefault(); 
                const newStartDate = e.target.startDate.value;
                const newTargetDays = parseInt(e.target.targetDays.value);
                setStartDate(newStartDate); setTargetDays(newTargetDays); 
                if (db) db.collection('sites').doc(siteId).set({ startDate: newStartDate, targetDays: newTargetDays }, { merge: true });
                setShowSettingsModal(false); 
            };
            
            const closeModal = (setter) => (e) => { if(e.target === e.currentTarget) setter(false); };
            const getStatusColor = (status) => status === '합격' ? 'bg-green-100 text-green-600' : status === '불합격' ? 'bg-red-100 text-red-600' : 'bg-gray-100 text-gray-600';
            const handlePrint = () => { window.print(); };

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans relative pb-20">
                    <PrintReport data={{ workerList, riskWorks, noticeData, issueList, inspectionLog }} siteName={currentSiteInfo.name} currentDate={currentDate} accidentFreeDays={accidentFreeDays} targetDays={targetDays} />
                    <div className="no-print">
                        <header className={`bg-white shadow-sm sticky top-0 z-30 border-b-4 ${siteId === 'siteA' ? 'border-blue-500' : 'border-purple-500'}`}>
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
                                <div className="flex items-center w-1/4"><div><h1 className="text-xl font-bold text-gray-900 leading-tight">Safety ON</h1><p className="text-xs text-gray-500">스마트 안전보건 플랫폼</p></div></div>
                                <div className="flex-1 text-center">
                                    <h2 className={`text-2xl font-extrabold tracking-wide font-['SeoulHangang'] drop-shadow-sm ${currentSiteInfo.text}`}>{currentSiteInfo.name}</h2>
                                    <p className="text-xs text-gray-400 mt-1">" 남화의 미래를 켜다 "</p>
                                </div>
                                <div className="flex items-center justify-end space-x-6 w-1/4">
                                    <span className="text-sm font-medium text-gray-500 flex items-center hidden sm:flex"><CalendarIcon className="mr-2" size={16} /> {currentDate}</span>
                                    <div className="relative cursor-pointer"><Bell className="text-gray-400 hover:text-gray-600" /><span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-4 h-4 rounded-full flex items-center justify-center">3</span></div>
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white cursor-pointer ${currentSiteInfo.bg}`}>관리</div>
                                </div>
                            </div>
                        </header>

                        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <div className={`bg-gradient-to-r ${currentSiteInfo.gradient} rounded-2xl shadow-lg p-6 mb-8 text-white flex flex-col md:flex-row items-center justify-between animate-fade-in relative`}>
                                <button onClick={() => setShowSettingsModal(true)} className="absolute top-4 right-4 p-2 bg-white/20 rounded-full hover:bg-white/30 transition"><Settings size={20} className="text-white" /></button>
                                <div className="mb-4 md:mb-0">
                                    <h2 className="text-lg font-medium opacity-90 mb-1 flex items-center">우리 현장 무재해 기록 <button onClick={() => setShowSettingsModal(true)} className="ml-3 text-xs bg-white/20 hover:bg-white/30 px-2 py-1 rounded flex items-center transition cursor-pointer border border-transparent hover:border-white/40" title="클릭하여 날짜 수정">실착공일: {startDate} <Edit2 size={12} className="ml-1 opacity-70"/></button></h2>
                                    <div className="flex items-end"><span className="text-5xl font-bold mr-2">{accidentFreeDays}</span><span className="text-xl mb-2">일째</span><span className="ml-4 bg-white/20 px-3 py-1 rounded-full text-sm">목표: {targetDays}일</span></div>
                                </div>
                                <div className="flex space-x-8 text-center pr-12">
                                    <div className="cursor-pointer hover:bg-white/10 p-2 rounded-lg transition" onClick={() => setShowWorkerModal(true)}>
                                        <p className="text-sm opacity-75 mb-1 flex items-center justify-center">금일 출력 인원 <MoreHorizontal size={12} className="ml-1" /></p>
                                        <p className="text-2xl font-bold flex items-center justify-center"><Users size={20} className="mr-1" /> {workerList.reduce((acc, cur) => acc + parseInt(cur.count || 0), 0)}명</p>
                                    </div>
                                    <div className="h-12 w-px bg-white/30"></div>
                                    <div><p className="text-sm opacity-75 mb-1">고위험 작업</p><p className="text-2xl font-bold flex items-center justify-center text-yellow-300"><AlertTriangle size={20} className="mr-1" /> {riskWorks.length}건</p></div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div className="lg:col-span-2 space-y-6">
                                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 animate-fade-in" style={{animationDelay: '0.1s'}}>
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-bold text-gray-800 flex items-center"><AlertOctagon className="text-red-500 mr-2" size={20} /> 금일 고위험 작업 현황</h3>
                                            <span className="text-xs text-green-600 bg-green-50 px-2 py-1 rounded font-bold animate-pulse">● 실시간 동기화 중</span>
                                        </div>
                                        <div className="overflow-x-auto mb-2">
                                            <table className="w-full text-sm text-left">
                                                <thead className="bg-gray-50 text-gray-500"><tr><th className="px-3 py-3 rounded-l-lg">작업팀</th><th className="px-3 py-3">작업 내용</th><th className="px-3 py-3">위험도</th><th className="px-3 py-3">투입 인원</th><th className="px-3 py-3">감독자</th><th className="px-3 py-3">상태</th><th className="px-3 py-3 rounded-r-lg w-16">관리</th></tr></thead>
                                                <tbody className="divide-y divide-gray-100">
                                                    {riskWorks.map((work) => (
                                                        <tr key={work.id} className="hover:bg-gray-50">
                                                            {editingWorkId === work.id ? (
                                                                <>
                                                                    <td className="px-3 py-2"><input className="border rounded px-1 w-full" value={work.team} onChange={(e) => handleWorkChange(work.id, 'team', e.target.value)} /></td>
                                                                    <td className="px-3 py-2"><input className="border rounded px-1 w-full" value={work.task} onChange={(e) => handleWorkChange(work.id, 'task', e.target.value)} /></td>
                                                                    <td className="px-3 py-2"><select className="border rounded px-1" value={work.risk} onChange={(e) => handleWorkChange(work.id, 'risk', e.target.value)}><option value="상">상</option><option value="중">중</option><option value="하">하</option></select></td>
                                                                    <td className="px-3 py-2"><input type="number" className="border rounded px-1 w-full" value={work.workerCount} onChange={(e) => handleWorkChange(work.id, 'workerCount', e.target.value)} /></td>
                                                                    <td className="px-3 py-2"><input className="border rounded px-1 w-full" value={work.manager} onChange={(e) => handleWorkChange(work.id, 'manager', e.target.value)} /></td>
                                                                    <td className="px-3 py-2"><select className="border rounded px-1" value={work.status} onChange={(e) => handleWorkChange(work.id, 'status', e.target.value)}><option value="예정">예정</option><option value="진행">진행</option><option value="완료">완료</option></select></td>
                                                                    <td className="px-3 py-2 text-center"><button onClick={() => handleWorkSave(work.id)} className="text-green-600 bg-green-100 p-1 rounded"><Save size={16} /></button></td>
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <td className="px-3 py-3 font-medium">{work.team}</td>
                                                                    <td className="px-3 py-3">{work.task}</td>
                                                                    <td className="px-3 py-3"><span className={`px-2 py-1 rounded text-xs font-bold ${work.risk === '상' ? 'bg-red-100 text-red-600' : 'bg-yellow-100 text-yellow-600'}`}>{work.risk}</span></td>
                                                                    <td className="px-3 py-3 font-bold text-blue-600">{work.workerCount}명</td>
                                                                    <td className="px-3 py-3">{work.manager}</td>
                                                                    <td className="px-3 py-3"><span className="flex items-center text-gray-500"><span className={`w-2 h-2 rounded-full mr-2 ${work.status === '진행' ? 'bg-green-500 animate-pulse' : 'bg-gray-300'}`}></span>{work.status}</span></td>
                                                                    <td className="px-3 py-3 text-center">
                                                                        <button onClick={() => handleWorkEdit(work.id)} className="text-blue-500 p-1 rounded hover:bg-blue-50"><Edit2 size={16} /></button>
                                                                        <button onClick={() => handleDeleteWork(work.id)} className="text-red-500 p-1 rounded hover:bg-red-50 ml-1"><Trash size={16} /></button>
                                                                    </td>
                                                                </>
                                                            )}
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                        <button onClick={handleAddWork} className="w-full py-2 border-2 border-dashed border-gray-200 rounded-lg text-gray-400 hover:border-blue-400 hover:text-blue-500 transition text-sm font-bold flex items-center justify-center"><Plus size={16} className="mr-1" /> 작업 추가하기</button>
                                    </div>

                                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 animate-fade-in" style={{animationDelay: '0.2s'}}>
                                        <div className="flex items-center justify-between mb-6"><h3 className="text-lg font-bold text-gray-800 flex items-center"><ClipboardCheck className="text-blue-500 mr-2" size={20} /> 고위험 작업 안전 관리 (교육 & 위험성평가)</h3></div>
                                        {riskWorks.length === 0 ? <div className="text-center py-8 text-gray-400 border-2 border-dashed rounded-lg">등록된 고위험 작업이 없습니다.</div> : (
                                            <div className="space-y-6">
                                                {riskWorks.map((work) => {
                                                    const rate = parseInt(work.workerCount) > 0 ? Math.round((parseInt(work.eduCompleted) / parseInt(work.workerCount)) * 100) : 0;
                                                    return (
                                                        <div key={work.id} className="border border-gray-200 rounded-xl p-5 bg-gray-50 hover:bg-white transition hover:shadow-md">
                                                            <div className="flex flex-col md:flex-row justify-between md:items-center mb-4 gap-4">
                                                                <div>
                                                                    <div className="flex items-center gap-2 mb-1"><span className="bg-gray-200 text-gray-600 text-xs px-2 py-0.5 rounded font-bold">{work.team}</span><span className={`text-xs px-2 py-0.5 rounded font-bold ${work.risk === '상' ? 'bg-red-100 text-red-600' : 'bg-yellow-100 text-yellow-600'}`}>위험도 {work.risk}</span></div>
                                                                    <h4 className="font-bold text-gray-800 text-lg">{work.task}</h4>
                                                                </div>
                                                                <div className="flex-1 max-w-md bg-white p-3 rounded-lg border border-gray-100 shadow-sm">
                                                                    <div className="flex justify-between items-center mb-2"><span className="text-sm font-bold text-gray-600">특별 안전 교육 이수 현황</span><span className={`text-sm font-bold ${rate === 100 ? 'text-green-600' : 'text-orange-500'}`}>{rate}% 달성</span></div>
                                                                    <div className="w-full bg-gray-200 rounded-full h-2.5 mb-2"><div className={`h-2.5 rounded-full transition-all duration-500 ${rate === 100 ? 'bg-green-500' : 'bg-blue-500'}`} style={{width: `${rate}%`}}></div></div>
                                                                    <div className="flex justify-between items-center text-xs"><span className="text-gray-500">교육 대상: <strong className="text-gray-800">{work.workerCount}명</strong></span><div className="flex items-center gap-2"><span>이수 완료:</span><input type="number" min="0" max={work.workerCount} className="w-16 border rounded px-1 py-0.5 text-center font-bold" value={work.eduCompleted} onChange={(e) => handleWorkChange(work.id, 'eduCompleted', parseInt(e.target.value) || 0)} onBlur={() => handleWorkSave(work.id)} /><span>명</span></div></div>
                                                                </div>
                                                            </div>
                                                            <div className="mt-3">
                                                                <label className="block text-xs font-bold text-gray-500 mb-1 ml-1">사전 위험성평가 및 중점 관리 대책</label>
                                                                <textarea className="w-full p-3 text-sm border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 resize-none bg-white" rows="2" placeholder="주요 위험 요인과 안전 대책을 입력하세요." value={work.assessment} onChange={(e) => handleWorkChange(work.id, 'assessment', e.target.value)} onBlur={() => handleWorkSave(work.id)}></textarea>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}
                                    </div>

                                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 animate-fade-in" style={{animationDelay: '0.3s'}}>
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-bold text-gray-800 flex items-center"><MessageSquare className="text-purple-500 mr-2" size={20} /> Safety 알림 게시판</h3>
                                            <button onClick={handleAddNotice} className="text-sm px-3 py-1 bg-purple-50 text-purple-600 rounded hover:bg-purple-100 transition flex items-center"><Plus size={12} className="mr-1" /> 글쓰기</button>
                                        </div>
                                        <div className="space-y-3">
                                            {noticeData.map((notice) => (
                                                <div key={notice.id} onClick={() => setSelectedNotice(notice)} className="flex items-center justify-between p-3 border-b border-gray-50 hover:bg-gray-50 transition cursor-pointer group">
                                                    <div className="flex items-center gap-3"><span className={`text-xs font-bold px-2 py-1 rounded ${notice.type === '공지' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'}`}>{notice.type}</span><span className="text-sm font-medium text-gray-800 hover:text-blue-600 transition">{notice.title}</span></div>
                                                    <div className="flex items-center text-xs text-gray-400 gap-3">
                                                        <span>{notice.author}</span><span>{notice.date}</span>
                                                        <button onClick={(e) => { e.stopPropagation(); handleDeleteNotice(notice.id); }} className="p-1 hover:bg-red-100 rounded text-gray-400 hover:text-red-500 transition ml-2"><Trash size={14} /></button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="space-y-6">
                                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 animate-fade-in" style={{animationDelay: '0.4s'}}>
                                        <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center"><CheckCircle className="text-green-500 mr-2" size={20} /> 안전 부적합 조치</h3>
                                        <div className="space-y-3">
                                            <div onClick={() => { setSelectedIssueType('new'); setShowIssueModal(true); }} className="flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-100 cursor-pointer hover:-translate-y-1 transition"><div className="flex items-center"><div className="w-8 h-8 rounded-full bg-red-200 flex items-center justify-center text-red-600 mr-3"><AlertTriangle size={16} /></div><span className="text-sm font-bold text-gray-700">신규 발견 (접수 대기)</span></div><span className="text-xl font-bold text-red-600">{issueCounts.new}</span></div>
                                            <div onClick={() => { setSelectedIssueType('processing'); setShowIssueModal(true); }} className="flex items-center justify-between p-4 bg-yellow-50 rounded-lg border border-yellow-100 cursor-pointer hover:-translate-y-1 transition"><div className="flex items-center"><div className="w-8 h-8 rounded-full bg-yellow-200 flex items-center justify-center text-yellow-600 mr-3"><Activity size={16} /></div><span className="text-sm font-bold text-gray-700">조치 중 (진행)</span></div><span className="text-xl font-bold text-yellow-600">{issueCounts.processing}</span></div>
                                            <div onClick={() => { setSelectedIssueType('done'); setShowIssueModal(true); }} className="flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-100 cursor-pointer hover:-translate-y-1 transition"><div className="flex items-center"><div className="w-8 h-8 rounded-full bg-green-200 flex items-center justify-center text-green-600 mr-3"><CheckCircle size={16} /></div><span className="text-sm font-bold text-gray-700">조치 완료</span></div><span className="text-xl font-bold text-green-600">{issueCounts.done}</span></div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 animate-fade-in" style={{animationDelay: '0.5s'}}>
                                        <h3 className="text-lg font-bold text-gray-800 mb-4">반입 점검 및 알림</h3>
                                        <div className="grid grid-cols-1 gap-2 mb-4">
                                            <button onClick={() => openInspectionModal('건설장비')} className="py-2.5 bg-blue-50 text-blue-700 rounded-lg text-sm font-bold hover:bg-blue-100 flex items-center justify-center border border-blue-100"><Truck size={16} className="mr-2"/> 건설장비 점검</button>
                                            <button onClick={() => openInspectionModal('기계기구')} className="py-2.5 bg-orange-50 text-orange-700 rounded-lg text-sm font-bold hover:bg-orange-100 flex items-center justify-center border border-orange-100"><Tool size={16} className="mr-2"/> 기계기구 점검</button>
                                            <button onClick={() => openInspectionModal('유해화학물질')} className="py-2.5 bg-purple-50 text-purple-700 rounded-lg text-sm font-bold hover:bg-purple-100 flex items-center justify-center border border-purple-100"><FlaskConical size={16} className="mr-2"/> 유해화학물질 점검</button>
                                        </div>
                                        <ul className="space-y-3 mt-4">
                                            {inspectionLog.slice(0, 5).map(log => (
                                                <li key={log.id} className="flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-100 text-sm">
                                                    <div className="flex flex-col"><span className="font-medium text-gray-700">{log.item}</span><span className="text-xs text-gray-500">{log.type} | {log.date}</span></div>
                                                    <span className={`text-xs px-2 py-1 rounded font-bold ${getStatusColor(log.status)}`}>{log.status}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </main>
                        
                        <footer className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 border-t border-gray-200 mt-8 relative flex justify-center items-center">
                            <p className="text-gray-400 text-sm font-medium">남화토건(주) 안전보건팀</p>
                            <div className="absolute right-4 flex space-x-2">
                                <button onClick={handlePrint} className="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-blue-700 transition shadow-sm whitespace-nowrap"><Printer size={16} className="mr-2" /> PDF 보고서 출력</button>
                                <a href={currentSiteInfo.link} target="_blank" className="flex items-center bg-purple-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-purple-700 transition shadow-sm whitespace-nowrap"><LinkIcon size={16} className="mr-2" /> 예정공정표</a>
                                <a href="index.html" className="flex items-center bg-gray-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-gray-700 transition shadow-sm whitespace-nowrap">나가기</a>
                            </div>
                        </footer>

                        {showSettingsModal && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in" onClick={closeModal(setShowSettingsModal)}>
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm" onClick={e => e.stopPropagation()}>
                                    <div className="p-4 flex justify-between items-center bg-gray-800 text-white rounded-t-xl"><h3 className="font-bold">무재해 목표 설정</h3><button onClick={() => setShowSettingsModal(false)}><X size={24} /></button></div>
                                    <form onSubmit={handleSaveSettings} className="p-6 space-y-4">
                                        <div><label className="block text-sm font-bold text-gray-700 mb-1">실착공일</label><input name="startDate" type="date" defaultValue={startDate} className="w-full border rounded-lg p-2" required /></div>
                                        <div><label className="block text-sm font-medium text-gray-700 mb-1">목표일수</label><input name="targetDays" type="number" defaultValue={targetDays} className="w-full border rounded-lg p-2" required /></div>
                                        <button type="submit" className="w-full bg-blue-600 text-white py-2.5 rounded-lg font-bold hover:bg-blue-700">설정 저장</button>
                                    </form>
                                </div>
                            </div>
                        )}

                        {showWorkerModal && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center animate-fade-in" onClick={closeModal(setShowWorkerModal)}>
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden" onClick={e => e.stopPropagation()}>
                                    <div className="bg-green-600 p-4 flex justify-between items-center text-white"><h3 className="font-bold">금일 출력 인원 수정</h3><button onClick={() => setShowWorkerModal(false)}><X size={20} /></button></div>
                                    <div className="p-4">
                                        <div className="space-y-2 max-h-[60vh] overflow-y-auto mb-3">
                                            {workerList.map((worker) => (
                                                <div key={worker.id} className="flex items-center gap-2 mb-2">
                                                    <input type="text" className="border p-2 rounded w-1/2 text-sm" value={worker.trade} onChange={(e) => handleWorkerChange(worker.id, 'trade', e.target.value)} placeholder="공종명"/>
                                                    <input type="number" className="border p-2 rounded w-1/3 text-sm" value={worker.count} onChange={(e) => handleWorkerChange(worker.id, 'count', e.target.value)} placeholder="인원"/>
                                                    <button onClick={() => handleDeleteWorker(worker.id)} className="text-red-400 hover:text-red-600"><Trash size={16} /></button>
                                                </div>
                                            ))}
                                        </div>
                                        <button onClick={handleAddWorker} className="w-full py-2 bg-gray-100 text-gray-600 rounded-lg text-sm font-bold hover:bg-gray-200">+ 공종 추가</button>
                                        <button onClick={saveWorkersToDB} className="w-full mt-2 py-2 bg-green-600 text-white rounded-lg text-sm font-bold hover:bg-green-700">저장 및 닫기</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showIssueModal && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in" onClick={closeModal(setShowIssueModal)}>
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col" onClick={e => e.stopPropagation()}>
                                    <div className={`p-5 flex justify-between items-center text-white rounded-t-xl shrink-0 ${selectedIssueType === 'new' ? 'bg-red-500' : selectedIssueType === 'processing' ? 'bg-yellow-500' : 'bg-green-500'}`}>
                                        <h3 className="font-bold text-lg">{selectedIssueType === 'new' ? '신규 발견 목록' : selectedIssueType === 'processing' ? '조치 중 목록' : '조치 완료 목록'}</h3>
                                        <button onClick={() => setShowIssueModal(false)} className="hover:bg-white/20 rounded-full p-1 transition"><X size={24} /></button>
                                    </div>
                                    <div className="p-6 space-y-6 overflow-y-auto bg-gray-50 flex-1">
                                        {selectedIssueType === 'new' && (
                                            <button onClick={handleAddIssue} className="w-full py-3 bg-red-50 text-red-600 rounded-lg border-2 border-dashed border-red-200 font-bold mb-4 hover:bg-red-100 transition flex items-center justify-center">
                                                <Plus size={18} className="mr-2"/> + 신규 부적합 사항 등록
                                            </button>
                                        )}
                                        {filteredIssues.length > 0 ? filteredIssues.map(issue => (
                                            <div key={issue.id} className="bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-200">
                                                <div className="flex justify-between items-end mb-4 pb-2 border-b border-gray-100">
                                                    <div className="flex-1 mr-4"><input type="text" className="w-full text-xl font-bold text-gray-800 bg-transparent placeholder-gray-300 focus:outline-none focus:placeholder-gray-200" value={issue.loc} onChange={(e) => handleIssueChange(issue.id, 'loc', e.target.value)} placeholder="장소 입력 (예: 105동 3층)"/></div>
                                                    <div className="flex items-center bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-100"><span className="text-xs text-gray-500 mr-2 font-medium">발견자:</span><input type="text" className="bg-transparent text-sm text-gray-700 font-medium focus:outline-none w-20 text-right border-b border-gray-300 focus:border-gray-500" value={issue.finder} onChange={(e) => handleIssueChange(issue.id, 'finder', e.target.value)}/></div>
                                                </div>
                                                <textarea className="w-full border border-gray-200 rounded-lg p-4 text-gray-700 text-sm focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-50 resize-none h-28 mb-5 placeholder-gray-300 leading-relaxed" value={issue.desc} onChange={(e) => handleIssueChange(issue.id, 'desc', e.target.value)} placeholder="안전 부적합 사항을 상세히 입력하세요."/>
                                                <div className="grid grid-cols-2 gap-4 mb-6">
                                                    <label className="group border-2 border-dashed border-gray-200 rounded-xl h-32 flex flex-col items-center justify-center cursor-pointer hover:border-gray-400 transition-colors bg-gray-50 hover:bg-white overflow-hidden relative">
                                                        {issue.beforeImg ? <img src={issue.beforeImg} alt="조치 전" className="w-full h-full object-cover" /> : <><div className="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mb-2 group-hover:bg-gray-200 transition"><Upload size={18} className="text-gray-400 group-hover:text-gray-600"/></div><span className="text-xs font-bold text-gray-400 group-hover:text-gray-600">조치 전 사진</span></>}
                                                        <input type="file" className="hidden" accept="image/*" onChange={(e) => handleIssueImageUpload(issue.id, 'beforeImg', e)} />
                                                    </label>
                                                    <label className="group border-2 border-dashed border-gray-200 rounded-xl h-32 flex flex-col items-center justify-center cursor-pointer hover:border-green-400 transition-colors bg-gray-50 hover:bg-white overflow-hidden relative">
                                                        {issue.afterImg ? <img src={issue.afterImg} alt="조치 후" className="w-full h-full object-cover" /> : <><div className="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mb-2 group-hover:bg-green-50 transition"><Upload size={18} className="text-gray-400 group-hover:text-green-500"/></div><span className="text-xs font-bold text-gray-400 group-hover:text-green-600">조치 후 사진</span></>}
                                                        <input type="file" className="hidden" accept="image/*" onChange={(e) => handleIssueImageUpload(issue.id, 'afterImg', e)} />
                                                    </label>
                                                </div>
                                                <div className="flex gap-3">
                                                    <button className="flex-1 bg-gray-100 text-gray-600 py-3.5 rounded-lg text-sm font-bold hover:bg-gray-200 transition-colors" onClick={saveIssueChanges}>내용 저장</button>
                                                    {selectedIssueType === 'new' && <button className="flex-1 bg-yellow-500 text-white py-3.5 rounded-lg text-sm font-bold hover:bg-yellow-600 transition-colors flex items-center justify-center shadow-md hover:shadow-lg transform active:scale-95 duration-200" onClick={() => changeIssueStatus(issue.id, 'processing')}>조치 착수 <ArrowRight size={16} className="ml-2" /></button>}
                                                    {selectedIssueType === 'processing' && <button className="flex-1 bg-green-500 text-white py-3.5 rounded-lg text-sm font-bold hover:bg-green-600 transition-colors flex items-center justify-center shadow-md hover:shadow-lg transform active:scale-95 duration-200" onClick={() => changeIssueStatus(issue.id, 'done')}>조치 완료 승인 <CheckCircle size={16} className="ml-2" /></button>}
                                                    {selectedIssueType === 'done' && <div className="flex-1 bg-gray-50 border border-gray-200 text-green-600 py-3.5 rounded-lg text-sm font-bold flex items-center justify-center cursor-default">완료된 항목 <CheckCircle size={16} className="ml-2" /></div>}
                                                </div>
                                            </div>
                                        )) : (
                                            <div className="text-center text-gray-400 py-20 flex flex-col items-center"><div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-300"><AlertTriangle size={32} /></div><p>{selectedIssueType === 'new' ? '신규 발견된 항목이 없습니다.' : selectedIssueType === 'processing' ? '조치 중인 항목이 없습니다.' : '완료된 항목이 없습니다.'}</p></div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {showInspectionModal && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in" onClick={closeModal(setShowInspectionModal)}>
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-md" onClick={e => e.stopPropagation()}>
                                    <div className="p-4 flex justify-between items-center bg-blue-600 text-white rounded-t-xl"><h3 className="font-bold">{inspectionType} 점검 등록</h3><button onClick={() => setShowInspectionModal(false)}><X size={24} /></button></div>
                                    <form onSubmit={handleSaveInspection} className="p-6 space-y-4">
                                        <div><label className="block text-sm font-medium text-gray-700 mb-1">품목명 / 장비명</label><input name="item" type="text" className="w-full border rounded-lg p-2" required placeholder="예: 이동식 크레인, 에폭시 등" /></div>
                                        <div><label className="block text-sm font-medium text-gray-700 mb-2">점검 결과</label><div className="flex gap-4"><label className="flex items-center cursor-pointer"><input type="radio" name="result" value="합격" className="mr-2" defaultChecked /><span className="text-sm font-bold text-green-600">합격</span></label><label className="flex items-center cursor-pointer"><input type="radio" name="result" value="불합격" className="mr-2" /><span className="text-sm font-bold text-red-600">불합격</span></label></div></div>
                                        <div><label className="block text-sm font-medium text-gray-700 mb-1">세부 점검 내용</label><textarea className="w-full border rounded-lg p-2 h-20" placeholder="특이사항 및 점검 결과를 입력하세요"></textarea></div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">점검 사진 / 서류 첨부</label>
                                            <div className="flex flex-wrap gap-2 mb-2">
                                                {inspectionImages.map((img, idx) => (
                                                    <div key={idx} className="relative w-20 h-20 border rounded-lg overflow-hidden group">
                                                        <img src={img} className="w-full h-full object-cover" />
                                                        <button type="button" onClick={() => handleRemoveInspectionImage(idx)} className="absolute top-0 right-0 bg-red-500 text-white p-0.5 rounded-bl-lg opacity-0 group-hover:opacity-100 transition-opacity"><X size={12}/></button>
                                                    </div>
                                                ))}
                                                <label className="flex flex-col items-center justify-center w-20 h-20 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                                    <Plus className="w-6 h-6 text-gray-400" />
                                                    <input type="file" multiple className="hidden" accept="image/*" onChange={handleInspectionImageUpload} />
                                                </label>
                                            </div>
                                            <p className="text-xs text-gray-400">* 사진을 여러 장 선택하거나 추가할 수 있습니다.</p>
                                        </div>
                                        <button type="submit" className="w-full bg-blue-600 text-white py-2.5 rounded-lg font-bold hover:bg-blue-700">저장 하기</button>
                                    </form>
                                </div>
                            </div>
                        )}

                        {selectedNotice && (
                            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in" onClick={closeModal(() => setSelectedNotice(null))}>
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-md" onClick={e => e.stopPropagation()}>
                                    <div className="p-4 flex justify-between items-center bg-purple-600 text-white rounded-t-xl"><h3 className="font-bold">공지사항 상세</h3><button onClick={() => setSelectedNotice(null)}><X size={24} /></button></div>
                                    <div className="p-6">
                                        <div className="flex items-center gap-2 mb-4"><span className={`text-xs font-bold px-2 py-1 rounded ${selectedNotice.type === '공지' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'}`}>{selectedNotice.type}</span><span className="text-sm text-gray-500">{selectedNotice.date} | {selectedNotice.author}</span></div>
                                        <h4 className="text-xl font-bold text-gray-800 mb-4">{selectedNotice.title}</h4>
                                        <div className="bg-gray-50 p-4 rounded-lg text-gray-700 text-sm min-h-[150px] whitespace-pre-wrap leading-relaxed">{selectedNotice.content}</div>
                                        <button onClick={() => setSelectedNotice(null)} className="w-full mt-4 bg-gray-200 text-gray-700 py-2 rounded-lg font-bold hover:bg-gray-300 transition">닫기</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div> 
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SafetyDashboard />);
    </script>
</body>
</html>